
my_hex3 = "0301000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
my_hex2 = "02111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000"
my_hex1 = "01111111111111111111111111111111111111111111111111111111111111111108000000"

import time
import serial

port1 = "COM4"          # or your port
baudrate1 = 9600


start = time.perf_counter()

ser = serial.Serial(
    port=port1,                # or '/dev/ttyUSB0' on Linux, '/dev/tty.usbserial' on macOS
    baudrate=baudrate1,
    bytesize=serial.EIGHTBITS,  # 8 data bits
    parity=serial.PARITY_NONE,  # No parity
    stopbits=serial.STOPBITS_ONE,  # 1 stop bit
    timeout=1,                  # read timeout (seconds)
    write_timeout=1.0,          # write timeout (seconds)
    xonxoff=False,              # disable software flow control
    rtscts=False,               # disable hardware (RTS/CTS) flow control
    dsrdtr=False                # disable DSR/DTR flow control
)

def read_until_silence(ser, idle_timeout=0.05, overall_timeout=3.0, chunk_size=4096):
    """
    Returns all bytes received until no new data arrives for idle_timeout,
    or overall_timeout is reached.
    """
    start = time.time()
    last_rx = start
    buf = bytearray()

    while True:
        # read whatever is available right now
        chunk = ser.read(ser.in_waiting or chunk_size)
        if chunk:
            buf.extend(chunk)
            last_rx = time.time()

        # stop if we've been idle long enough
        if time.time() - last_rx >= idle_timeout and len(buf) > 0:
            break

        # safety stop
        if time.time() - start >= overall_timeout:
            break
    end = time.time()
    print(end - start)
    return bytes(buf)

# ----- example usage -----
# (optional) clear any stale bytes before sending
ser.reset_input_buffer()
ser.reset_output_buffer()

# send your command
tx = bytes.fromhex(my_hex3)
ser.write(tx)

# receive variable-length reply
rx = read_until_silence(ser, idle_timeout=0.05, overall_timeout=3.0)

print(f"received {len(rx)} bytes")
rxb = rx[::-1]
print(rxb.hex())            # or print a preview: rx[:64].hex()

ser.close()

